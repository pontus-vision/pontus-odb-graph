rules:

  govbr_fontes_de_dados:
    vertices:
      - label: Object_Data_Source
        name: gov.br
        props:
          Name: BUDIBASE/FONTES-DE-DADOS

      - label: Object_Data_Source
        condition: "${Descricao?.trim()?.length() > 0}"
        name: fontes_de_dados
        props:
          Form_Id: "${_id}"
          Name:
            val: "${Referencia?.trim()?.toUpperCase()}"
            excludeFromSearch: true
          Description:
            val: "${Descricao?.trim()?.toUpperCase()}"
            excludeFromSearch: true
          Engine:
            val: "${Sistema}"
            excludeFromSearch: true
          Type:
            val: "${Subsistema}"
            excludeFromSearch: true
          Domain:
            val: "${Modulo}"
            excludeFromSearch: true
          URI_Delete:
            val: "${URL_Prefixo_Delete}"
            excludeFromSearch: true
          URI_Update:
            val: "${URL_Prefixo_Update}"
            excludeFromSearch: true
          URI_Read:
            val: "${URL_Prefixo_Read}"
            excludeFromSearch: true

      - label: Object_System
        props:
          Name: "${Sistema?.trim()?.toUpperCase()}"

      - label: Object_Subsystem
        props:
          Name: "${Subsistema?.trim()?.toUpperCase()}"

      - label: Object_Module
        props:
          Name: "${Modulo?.trim()?.toLowerCase()}"

      - label: Object_Sensitive_Data
        props:
          Description:
            val: "${new groovy.json.JsonBuilder(Dados_Pessoais)}"
            type: "[Ljava.lang.String;"
            postProcessor: "${it?.toUpperCase()?.trim()}"
            processAll: true

      - label: Object_Data_Policy
        props:
          Update_Frequency: "${Frequencia_de_Atualizacao}"
          Retention_Period: "${Periodo_de_Retencao}"
          Type: "${Referencia}"

      - label: Event_Ingestion
        props:
          Type:
            val: budibase/fontes-de-dados
            excludeFromSearch: true
          Operation:
            val: Structured Data Insertion
            excludeFromSearch: true
          Domain_b64:
            val: "${original_request?.bytes?.encodeBase64()?.toString()}"
            excludeFromSearch: true
          Metadata_Create_Date:
            val: "${new Date()}"
            excludeFromSearch: true
            type: java.util.Date
          Metadata_Update_Date:
            val: "${new Date()}"
            excludeFromSearch: true
            type: java.util.Date

      - label: Event_Group_Ingestion
        props:
          Type: budibase/fontes-de-dados
          Operation: Structured Data Insertion
          Ingestion_Date: "${new java.text.SimpleDateFormat('yyyy-MM-dd').format(new Date())}"

      - label: Object_Email_Address
        condition: "${Responsavel?.size() > 0}"
        props:
          Form_Id:
            val: "${new groovy.json.JsonBuilder(Responsavel)}"
            type: "[Lcom.pontusvision.utils.BudibaseRef;"
            postProcessor: "${com.pontusvision.utils.BudibaseRef.fromString(it)?.getLookupId()}"
            processAll: true

    edges:
      - label: "Has_Ingestion_Event"
        fromVertexName: "gov.br"
        toVertexLabel: "Event_Group_Ingestion"

      - label: "Has_Ingestion_Event"
        fromVertexLabel: "Event_Group_Ingestion"
        toVertexLabel: "Event_Ingestion"

      - label: "Has_Ingestion_Event"
        fromVertexLabel: "Event_Ingestion"
        toVertexName: "fontes_de_dados"

      - label: "Has_Policy"
        fromVertexName: "fontes_de_dados"
        toVertexLabel: "Object_Data_Policy"

      - label: "Has_Sensitive_Data"
        fromVertexName: "fontes_de_dados"
        toVertexLabel: "Object_Sensitive_Data"

      - label: "Has_Module"
        fromVertexName: "fontes_de_dados"
        toVertexLabel: "Object_Module"

      - label: "Has_Subsystem"
        fromVertexLabel: "Object_Module"
        toVertexLabel: "Object_Subsystem"

      - label: "Has_System"
        fromVertexLabel: "Object_Subsystem"
        toVertexLabel: "Object_System"

      - label: "Is_Responsible"
        fromVertexLabel: "Object_Email_Address"
        toVertexLabel: "fontes_de_dados"

  govbr_mapeamento_de_processo:
    vertices:
      - label: Object_Data_Source
        name: gov.br
        props:
          Name: GOV.BR/MAPEAMENTO-DE-PROCESSO

      - label: Object_Data_Source
        name: attached_data_sources
        props:
          Form_Id:
            val: "${new groovy.json.JsonBuilder(Local_de_Armazenamento)}"
            type: "[Lcom.pontusvision.utils.BudibaseRef;"
            postProcessor: "${com.pontusvision.utils.BudibaseRef.fromString(it)?.getLookupId()}"
            processAll: true

      - label: Object_Policies
        props:
          Form_Id:
            val: "${new groovy.json.JsonBuilder(Politicas)}"
            type: "[Lcom.pontusvision.utils.BudibaseRef;"
            postProcessor: "${com.pontusvision.utils.BudibaseRef.fromString(it)?.getLookupId()}"
            processAll: true

      - label: Object_Data_Procedures
        props:
          Form_Id: "${_id}"
          ID:
            val: "${Referencia}"
            excludeFromSearch: true
          Name:
            val: "${Processo}"
            excludeFromSearch: true
          Type_Of_Natural_Person:
            val: "${Categoria_dos_Titulares_dos_Dados}"
            excludeFromSearch: true
          BusinessAreaResponsible:
            val: "${Area_Responsavel}"
            excludeFromSearch: true
          Country_Where_Stored:
            val: "${Pais_Onde_as_Pessoas_Estao_Localizadas}"
            excludeFromSearch: true
          Why_Is_It_Collected:
            val: "${Finalidade_do_Processo}"
            excludeFromSearch: true
          Info_Collected:
            val: "${Dados_Pessoais_Utilizados}"
            excludeFromSearch: true
          Description:
            val: "${Fluxo_dos_Dados}"
            excludeFromSearch: true
          Interested_Parties_Consulted:
            val: "${Partes_Interessadas_Consultadas}"
            excludeFromSearch: true
          Info_Shared_With_Third_Parties:
            val: "${Dados_Pessoais_Compartilhados_com_Terceiros}"
            excludeFromSearch: true
          Info_Share_Justification:
            val: "${Finalidade_de_Compartilhamento_com_Terceiros}"
            excludeFromSearch: true
          MacroProcessName:
            val: "${Macroprocesso}"
            excludeFromSearch: true

      - label: Object_Sensitive_Data
        name: personal_data
        props:
          Description:
            val: "${new groovy.json.JsonBuilder(Dados_Pessoais_Utilizados)}"
            type: "[Ljava.lang.String;"
            postProcessor: "${it?.toUpperCase()?.trim()}"
            processAll: true

      - label: Object_Sensitive_Data
        name: sensitive_data
        props:
          Description:
            val: "${new groovy.json.JsonBuilder(Dados_Pessoais_Sensiveis)}"
            type: "[Ljava.lang.String;"
            postProcessor: "${it?.toUpperCase()?.trim()}"
            processAll: true

      - label: Object_Sensitive_Data
        name: shared_data
        props:
          Description:
            val: "${new groovy.json.JsonBuilder(Dados_Pessoais_Compartilhados_com_Terceiros)}"
            type: "[Ljava.lang.String;"
            postProcessor: "${it?.toUpperCase()?.trim()}"
            processAll: true

      - label: Object_Lawful_Basis
        name: lawful_basis
        props:
          Description:
            val: "${new groovy.json.JsonBuilder(Base_Legal)}"
            type: "[Ljava.lang.String;"
            postProcessor: "${it?.toUpperCase()?.trim()}"
            processAll: true

      - label: Object_Lawful_Basis
        condition: "${Outros_Fundamentos_Legais?.trim()?.length() > 0}"
        name: other_lawful_basis
        props:
          Description: "${Outros_Fundamentos_Legais?.toUpperCase()?.trim()}"

      - label: Object_Legitimate_Interests_Assessment
        condition: "${Justificativa_da_Base_Legal?.trim()?.length() > 0}"
        props:
          Lawful_Basis_Justification: "${Justificativa_da_Base_Legal}"

      - label: Object_Email_Address
        condition: "${Responsavel?.size() > 0}"
        props:
          Form_Id:
            val: "${new groovy.json.JsonBuilder(Responsavel)}"
            type: "[Lcom.pontusvision.utils.BudibaseRef;"
            postProcessor: "${com.pontusvision.utils.BudibaseRef.fromString(it)?.getLookupId()}"
            processAll: true

      - label: Event_Ingestion
        props:
          Type:
            val: gov.br/mapeamento-de-processo
            excludeFromSearch: true
          Operation:
            val: Structured Data Insertion
            excludeFromSearch: true
          Domain_b64:
            val: "${original_request?.bytes?.encodeBase64()?.toString()}"
            excludeFromSearch: true
          Metadata_Create_Date:
            val: "${new Date()}"
            excludeFromSearch: true
            type: java.util.Date
          Metadata_Update_Date:
            val: "${new Date()}"
            excludeFromSearch: true
            type: java.util.Date

      - label: Event_Group_Ingestion
        props:
          Type: gov.br/mapeamento-de-processo
          Operation: Structured Data Insertion
          Ingestion_Date: "${new java.text.SimpleDateFormat('yyyy-MM-dd').format(new Date())}"
    edges:
      - label: "Has_Ingestion_Event"
        fromVertexName: "gov.br"
        toVertexLabel: "Event_Group_Ingestion"

      - label: "Has_Ingestion_Event"
        fromVertexLabel: "Event_Group_Ingestion"
        toVertexLabel: "Event_Ingestion"

      - label: "Has_Ingestion_Event"
        fromVertexLabel: "Event_Ingestion"
        toVertexLabel: "Object_Data_Procedures"

      - label: "Has_Sensitive_Data"
        fromVertexLabel: "Object_Data_Procedures"
        toVertexName: "personal_data"

      - label: "Has_Sensitive_Data"
        fromVertexLabel: "Object_Data_Procedures"
        toVertexName: "sensitive_data"

      - label: "Has_Sensitive_Data"
        fromVertexLabel: "Object_Data_Procedures"
        toVertexName: "shared_data"

      - label: "Has_Lawful_Basis_On"
        fromVertexLabel: "Object_Data_Procedures"
        toVertexName: "lawful_basis"

      - label: "Has_Other_Lawful_Basis"
        fromVertexLabel: "Object_Data_Procedures"
        toVertexName: "other_lawful_basis"

      - label: "Has_Policy"
        fromVertexLabel: "Object_Data_Procedures"
        toVertexLabel: "Object_Policies"

      - label: "Has_Data_Source"
        fromVertexLabel: "Object_Data_Procedures"
        toVertexName: "attached_data_sources"

      - label: "Has_Legitimate_Interests_Assessment"
        fromVertexLabel: "Object_Data_Procedures"
        toVertexLabel: "Object_Legitimate_Interests_Assessment"

      - label: "Is_Responsible"
        fromVertexLabel: "Object_Email_Address"
        toVertexLabel: "Object_Data_Procedures"

  govbr_politicas:
    vertices:

      - label: Object_Policies
        props:
          Form_Id: "${_id}"
          Name:
            val: "${Referencia?.trim()?.toUpperCase()}"
            excludeFromSearch: true
          Text:
            val: "${Texto}"
            excludeFromUpdate: true
          Type:
            val: "${Tipo_de_Politica}"
            excludeFromUpdate: true

      - label: Object_Data_Source
        props:
          Name: "GOV.BR/POLÍTICAS"

      - label: Event_Ingestion
        props:
          Type:
            val: "gov.br/políticas"
            excludeFromSearch: true
          Operation:
            val: "Structured Data Insertion"
            excludeFromSearch: true
          Domain_b64:
            val: "${original_request?.bytes?.encodeBase64()?.toString()}"
            excludeFromSearch: true
          Metadata_Create_Date:
            val: "${new Date()}"
            excludeFromSearch: true
            type: java.util.Date
          Metadata_Update_Date:
            val: "${new Date()}"
            excludeFromSearch: true
            type: java.util.Date

      - label: Event_Group_Ingestion
        props:
          Type: "gov.br/políticas"
          Operation: "Structured Data Insertion"
          Ingestion_Date: "${new java.text.SimpleDateFormat('yyyy-MM-dd').format(new Date())}"

    edges:

      - label: Has_Ingestion_Event
        fromVertexLabel: "Object_Data_Source"
        toVertexLabel: "Event_Group_Ingestion"

      - label: Has_Ingestion_Event
        fromVertexLabel: "Event_Group_Ingestion"
        toVertexLabel: "Event_Ingestion"

      - label: Has_Ingestion_Event
        fromVertexName: "Object_Policies"
        toVertexLabel: "Event_Ingestion"

  govbr_users:
    vertices:
      - label: Person_Natural
        props:
          Full_Name:
            val: "${firstName?.toUpperCase()?.trim()} ${lastName?.toUpperCase()?.trim()}"
            excludeFromSearch: true
      - label: Object_Email_Address
        condition: "${email?.trim()?.length() > 0}"
        props:
          Form_Id: "${_id}"
          Email:
            val: "${email?.trim()?.toLowerCase()}"
            excludeFromSearch: true
      - label: Object_Data_Source
        props:
          Name: "GOV.BR/USERS"
      - label: Event_Ingestion
        props:
          Type:
            val: "gov.br/users"
            excludeFromSearch: true
          Operation:
            val: "Structured Data Insertion"
            excludeFromSearch: true
          Domain_b64:
            val: "${original_request?.bytes?.encodeBase64()?.toString()}"
            excludeFromSearch: true
          Metadata_Create_Date:
            val: "${new Date()}"
            excludeFromSearch: true
            type: java.util.Date
          Metadata_Update_Date:
            val: "${new Date()}"
            excludeFromSearch: true
            type: java.util.Date
      - label: Event_Group_Ingestion
        props:
          Type: "gov.br/users"
          Operation: "Structured Data Insertion"
          Ingestion_Date: "${new java.text.SimpleDateFormat('yyyy-MM-dd').format(new Date())}"
    edges:
      - label: Has_Ingestion_Event
        fromVertexLabel: "Object_Data_Source"
        toVertexLabel: "Event_Group_Ingestion"
      - label: Has_Ingestion_Event
        fromVertexLabel: "Event_Group_Ingestion"
        toVertexLabel: "Event_Ingestion"
      - label: Has_Ingestion_Event
        fromVertexLabel: "Event_Ingestion"
        toVertexLabel: "Person_Natural"
      - label: Uses_Email
        fromVertexLabel: "Person_Natural"
        toVertexLabel: "Object_Email_Address"
