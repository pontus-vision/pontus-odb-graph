
rules:

  salesforce:
    vertices:
      - label: "Person.Natural"
        props:
          Full_Name:
            val: "${FirstName?.toUpperCase()?.trim()} ${LastName?.toUpperCase()?.trim()}"
            predicate: "eq"
            mandatoryInSearch: true

          Full_Name_fuzzy:
            val: "${FirstName?.toUpperCase()?.trim()} ${LastName?.toUpperCase()?.trim()}"
            excludeFromSearch: true

          Last_Name:
            val: "${LastName?.toUpperCase()?.trim()}"
            excludeFromSubsequenceSearch: true

          Date_Of_Birth:
            val: "${Birthdate?:'1666-01-01'}"
            type: "java.util.Date"
            mandatoryInSearch: false
            excludeFromSubsequenceSearch: true

          Title:
            val: "${Title?:Salutation?:''}"
            excludeFromSearch: true

          Nationality:
            val: "${MailingCountry?:'Unknown'}"
            excludeFromSearch: true

          Customer_ID:
            val: "${Id}"
            mandatoryInSearch: true

          Gender:
            val: "Unknown"
            mandatoryInSearch: false
            excludeFromSubsequenceSearch: true

          Type:
            val: "${Tipo__c?Tipo__c.toLowerCase():'leads'}"
            mandatoryInSearch: false
            excludeFromSubsequenceSearch: true

      - label: "Object.Identity_Card"
        condition: "${ (CPF__c != null) && ! (CPF__c.isEmpty())}"
        props:
          Id_Type:
            val: "CPF"
            excludeFromSearch: true

          Id_Value:
            val: "${CPF__c.replaceAll('[^0-9]','')}"
            mandatoryInSearch: true

      - label: "Location.Address"
        props:
          Full_Address:
            val: "${ ( (MailingStreet?:'')+ '\\\\n' + (MailingCity?:'') + '\\\\n' + (MailingState?:'') + '\\\\n' + (MailingCountry?:'')).replaceAll('\\\\n', ' ') }"
            mandatoryInSearch: true

          parser:
            val: "${ ( (MailingStreet?:'')+ '\\\\n' + (MailingCity?:'') + '\\\\n' + (MailingState?:'') + '\\\\n' + (MailingCountry?:'')).replaceAll('\\\\n', ' ') }"
            excludeFromSearch: true
            type: "com.pontusvision.utils.LocationAddress"

          Post_Code:
            val: "${com.pontusvision.utils.PostCode.format(MailingPostalCode)}"
            excludeFromSearch: true

      - label: "Object.Email_Address"
        props:
          Email:
            val: "${Email?.trim()?.toLowerCase()}"
            mandatoryInSearch: true

      - label: "Object.Phone_Number"
        props:
          Raw:
            val: "${Phone}"
            mandatoryInSearch: false

          Type:
            val: "Work"
            excludeFromSubsequenceSearch: true

          Numbers_Only:
            val: "${(Phone?.replaceAll('[^0-9]', '')?:'00000000')}"
            excludeFromSearch: true
            type: "[Ljava.lang.String;"

          Last_7_Digits:
            val: "${(((Phone?.replaceAll('[^0-9]', ''))?:'0000000')[-7..-1])}"
            mandatoryInSearch: true
            type: "[Ljava.lang.String;"

      - label: "Object.Data_Source"
        props:
          Name:
            val: "salesforce.com"
            mandatoryInSearch: true
          Type:
            val: "salesforce.com"
            mandatoryInSearch: true
          Description:
            val: "Salesforce.com CRM system data"
            mandatoryInSearch: true

      - label: Event.Group_Ingestion
        props:
          Type:
            val: Salesforce CRM System
            mandatoryInSearch: true
          Operation:
            val: Structured Data Insertion
            mandatoryInSearch: true
          Ingestion_Date:
            val: "${new java.text.SimpleDateFormat('yyyy-MM-dd').format(new Date())}"
            mandatoryInSearch: true
          Metadata_Start_Date:
            val: "${new Date()}"
            #            mandatoryInSearch: false
            excludeFromSearch: true
            type: java.util.Date
          Metadata_End_Date:
            val: "${new Date()}"
            excludeFromSearch: true
            type: java.util.Date


      - label: "Event.Ingestion"
        props:
          Type:
            val: "Salesforce CRM System"
            excludeFromSearch: true

          Operation:
            val: "Structured Data Insertion"
            excludeFromSearch: true

          Domain_b64:
            val: "${original_request?.bytes?.encodeBase64()?.toString()}"
            excludeFromSearch: true

          Metadata_Create_Date:
            val: "${new Date()}"
            excludeFromSearch: true
            type: "java.util.Date"

      - label: "Event.Consent"
        props:
          Status:
            val: "Consentimento"
            excludeFromSearch: true
          Date:
            val: "${new Date()}"
            excludeFromSearch: true
            type: "java.util.Date"
      - label: "Object.Privacy_Notice"
        props:
          Who_Is_Collecting:
            val: "[CRM System]"
            excludeFromUpdate: true
    edges:
      - label: "Uses_Email"
        fromVertexLabel: "Person.Natural"
        toVertexLabel: "Object.Email_Address"

      - label: "Has_Id_Card"
        fromVertexLabel: "Person.Natural"
        toVertexLabel: "Object.Identity_Card"

      - label: "Has_Phone"
        fromVertexLabel: "Person.Natural"
        toVertexLabel: "Object.Home_Phone_Number"

      - label: "Has_Phone"
        fromVertexLabel: "Person.Natural"
        toVertexLabel: "Object.Phone_Number"

      - label: "Lives"
        fromVertexLabel: "Person.Natural"
        toVertexLabel: "Location.Address"

      - label: "Has_Ingestion_Event"
        fromVertexLabel: "Person.Natural"
        toVertexLabel: "Event.Ingestion"

      - label: "Has_Ingestion_Event"
        fromVertexLabel: "Event.Group_Ingestion"
        toVertexLabel: "Event.Ingestion"

      - label: "Has_Ingestion_Event"
        toVertexLabel: "Event.Group_Ingestion"
        fromVertexLabel: "Object.Data_Source"

      - label: "Consent"
        fromVertexLabel: "Person.Natural"
        toVertexLabel: "Event.Consent"

      - label: "Has_Privacy_Notice"
        fromVertexLabel: "Event.Consent"
        toVertexLabel: "Object.Privacy_Notice"
